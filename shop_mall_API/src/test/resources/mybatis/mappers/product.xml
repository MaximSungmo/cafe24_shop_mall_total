<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
	
	<!-- 테스트 데이터 삭제용 코드 -->
	<delete id="delete_product_all">
		<![CDATA[
			delete from PRODUCT where no >0
		]]>
	</delete>
	<delete id="delete_product_detail_all">
		<![CDATA[
			delete from PRODUCT_DETAIL where no >0
		]]>
	</delete>
	<delete id="delete_product_image_all">
		<![CDATA[
			delete from PRODUCT_IMAGE where no >0
		]]>
	</delete>

	<!-- 실제 서비스 코드 -->
	<insert id="insert_product" parameterType="productvo">
		<![CDATA[
			insert into PRODUCT 
		    values(null, #{name}, #{description}, #{status}, #{use_fl}, #{like_cnt}, now(), #{category_no}, #{brand_no});	
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<insert id="insert_product_detail" parameterType="productdetailvo">
		<![CDATA[
			insert into PRODUCT_DETAIL 
		    values(null, #{product_no}, #{product_option}, #{stock_cd}, #{stock_cnt}, #{warehouse_no});	
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<insert id="insert_product_image" parameterType="productimagevo">
		<![CDATA[
			insert into PRODUCT_IMAGE 
		    values(null, #{product_no}, #{url}, now(), #{use_fl}, #{product_image_category_no});	
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	
	<select id="get_product_list" parameterType="map" resultType="productvo">
		<![CDATA[
			select no, name, description, status, use_fl, like_cnt, register_dt, category_no, brand_no 
			from PRODUCT		 
		]]>	
		
		<if test='category_no!=0'>
			<![CDATA[
				where category_no=#{category_no}
			]]>	
			<if test="kwd!=''">
				<![CDATA[
					and name like CONCAT('%',#{kwd},'%')
				]]>
			</if>
		</if>
		
		<if test='category_no==0'>
			<if test="kwd!=''">
				<![CDATA[
					where name like CONCAT('%',#{kwd},'%')
				]]>
			</if>
		</if>
		<![CDATA[
			limit #{get_count} offset #{last_product_no}
		]]>	
	</select>
	
	
	<update id="update_product" parameterType="productvo">
		<![CDATA[
			update PRODUCT
			set name=#{name}, description=#{description}, status=#{status}, register_dt=now(), category_no=#{category_no}, brand_no=#{brand_no}
			where no = #{no};
		]]>
	</update>
	
	<update id="delete_product" parameterType="long">
		<![CDATA[
			update PRODUCT
			set use_fl= "N"
			where no = #{no};
		]]>
	</update>
	
</mapper>